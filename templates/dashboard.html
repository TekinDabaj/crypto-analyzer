<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Crypto Market Analyzer</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      :root {
        --bg-primary: #0d1117;
        --bg-secondary: #161b22;
        --bg-tertiary: #21262d;
        --border: #30363d;
        --text-primary: #f0f6fc;
        --text-secondary: #8b949e;
        --green: #3fb950;
        --red: #f85149;
        --yellow: #d29922;
        --blue: #58a6ff;
        --purple: #a371f7;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, sans-serif;
        background: var(--bg-primary);
        color: var(--text-primary);
        min-height: 100vh;
      }

      /* Header */
      .header {
        background: var(--bg-secondary);
        border-bottom: 1px solid var(--border);
        padding: 16px 24px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .header h1 {
        font-size: 20px;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .header h1 span {
        font-size: 24px;
      }

      .status-bar {
        display: flex;
        gap: 24px;
        align-items: center;
      }

      .status-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 13px;
        color: var(--text-secondary);
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: var(--green);
        animation: pulse 2s infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
      }

      .btn {
        background: var(--blue);
        color: var(--bg-primary);
        border: none;
        padding: 8px 16px;
        border-radius: 6px;
        font-weight: 600;
        font-size: 13px;
        cursor: pointer;
        transition: all 0.2s;
      }

      .btn:hover {
        opacity: 0.9;
        transform: translateY(-1px);
      }

      /* Main Layout */
      .main {
        display: grid;
        grid-template-columns: 300px 1fr;
        height: calc(100vh - 65px);
      }

      /* Sidebar */
      .sidebar {
        background: var(--bg-secondary);
        border-right: 1px solid var(--border);
        padding: 20px;
        overflow-y: auto;
      }

      .section-title {
        font-size: 12px;
        text-transform: uppercase;
        color: var(--text-secondary);
        letter-spacing: 0.5px;
        margin-bottom: 12px;
        padding-bottom: 8px;
        border-bottom: 1px solid var(--border);
      }

      .stat-card {
        background: var(--bg-tertiary);
        border: 1px solid var(--border);
        border-radius: 8px;
        padding: 14px;
        margin-bottom: 12px;
      }

      .stat-label {
        font-size: 11px;
        color: var(--text-secondary);
        text-transform: uppercase;
        margin-bottom: 4px;
      }

      .stat-value {
        font-size: 24px;
        font-weight: 600;
      }

      .stat-change {
        font-size: 12px;
        margin-top: 4px;
      }

      .positive {
        color: var(--green);
      }
      .negative {
        color: var(--red);
      }
      .neutral {
        color: var(--yellow);
      }

      /* Legend */
      .legend {
        margin-top: 20px;
      }

      .legend-item {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 12px;
        color: var(--text-secondary);
        margin-bottom: 8px;
      }

      .grade-badge {
        padding: 2px 8px;
        border-radius: 4px;
        font-size: 11px;
        font-weight: 600;
      }

      .grade-a {
        background: rgba(63, 185, 80, 0.2);
        color: var(--green);
      }
      .grade-b {
        background: rgba(88, 166, 255, 0.2);
        color: var(--blue);
      }
      .grade-c {
        background: rgba(210, 153, 34, 0.2);
        color: var(--yellow);
      }
      .grade-d {
        background: rgba(248, 81, 73, 0.2);
        color: var(--red);
      }

      /* Content */
      .content {
        padding: 20px;
        overflow-y: auto;
      }

      .content-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .filter-tabs {
        display: flex;
        gap: 8px;
      }

      .filter-tab {
        padding: 6px 14px;
        border-radius: 20px;
        font-size: 13px;
        border: 1px solid var(--border);
        background: transparent;
        color: var(--text-secondary);
        cursor: pointer;
        transition: all 0.2s;
      }

      .filter-tab.active {
        background: var(--blue);
        color: var(--bg-primary);
        border-color: var(--blue);
      }

      /* Coins Table */
      .coins-table {
        width: 100%;
        border-collapse: collapse;
        background: var(--bg-secondary);
        border-radius: 8px;
        overflow: hidden;
        border: 1px solid var(--border);
      }

      .coins-table thead {
        background: var(--bg-tertiary);
      }

      .coins-table th {
        text-align: left;
        padding: 12px 16px;
        font-size: 11px;
        text-transform: uppercase;
        color: var(--text-secondary);
        font-weight: 600;
        letter-spacing: 0.5px;
      }

      .coins-table tbody tr {
        border-top: 1px solid var(--border);
        transition: background 0.2s;
        cursor: pointer;
      }

      .coins-table tbody tr:hover {
        background: var(--bg-tertiary);
      }

      .coins-table td {
        padding: 14px 16px;
        font-size: 14px;
      }

      .coin-name {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .coin-icon {
        width: 32px;
        height: 32px;
        border-radius: 50%;
        background: var(--bg-tertiary);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        font-size: 12px;
      }

      .coin-symbol {
        font-weight: 600;
      }

      .coin-pair {
        font-size: 11px;
        color: var(--text-secondary);
      }

      .indicator-bar {
        height: 6px;
        background: var(--bg-tertiary);
        border-radius: 3px;
        overflow: hidden;
        width: 80px;
      }

      .indicator-fill {
        height: 100%;
        border-radius: 3px;
        transition: width 0.3s;
      }

      .indicator-fill.high {
        background: var(--green);
      }
      .indicator-fill.medium {
        background: var(--yellow);
      }
      .indicator-fill.low {
        background: var(--red);
      }

      .signal-tags {
        display: flex;
        flex-wrap: wrap;
        gap: 4px;
      }

      .signal-tag {
        font-size: 11px;
        padding: 2px 6px;
        border-radius: 4px;
        background: var(--bg-tertiary);
        white-space: nowrap;
      }

      /* Score circle */
      .score-circle {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 700;
        font-size: 14px;
      }

      .score-a {
        background: rgba(63, 185, 80, 0.2);
        border: 2px solid var(--green);
        color: var(--green);
      }
      .score-b {
        background: rgba(88, 166, 255, 0.2);
        border: 2px solid var(--blue);
        color: var(--blue);
      }
      .score-c {
        background: rgba(210, 153, 34, 0.2);
        border: 2px solid var(--yellow);
        color: var(--yellow);
      }
      .score-d {
        background: rgba(248, 81, 73, 0.2);
        border: 2px solid var(--red);
        color: var(--red);
      }

      /* Modal */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.7);
        z-index: 200;
        align-items: center;
        justify-content: center;
      }

      .modal.active {
        display: flex;
      }

      .modal-content {
        background: var(--bg-secondary);
        border: 1px solid var(--border);
        border-radius: 12px;
        width: 90%;
        max-width: 700px;
        max-height: 80vh;
        overflow-y: auto;
      }

      .modal-header {
        padding: 20px;
        border-bottom: 1px solid var(--border);
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .modal-close {
        background: none;
        border: none;
        color: var(--text-secondary);
        font-size: 24px;
        cursor: pointer;
      }

      .modal-body {
        padding: 20px;
      }

      .detail-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 16px;
        margin-bottom: 20px;
      }

      .detail-card {
        background: var(--bg-tertiary);
        padding: 14px;
        border-radius: 8px;
      }

      .detail-label {
        font-size: 11px;
        color: var(--text-secondary);
        text-transform: uppercase;
        margin-bottom: 4px;
      }

      .detail-value {
        font-size: 18px;
        font-weight: 600;
      }

      .breakdown-list {
        list-style: none;
      }

      .breakdown-item {
        display: flex;
        justify-content: space-between;
        padding: 10px 0;
        border-bottom: 1px solid var(--border);
      }

      .breakdown-item:last-child {
        border-bottom: none;
      }

      /* Loading */
      .loading {
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 60px;
        color: var(--text-secondary);
      }

      .spinner {
        width: 24px;
        height: 24px;
        border: 2px solid var(--border);
        border-top-color: var(--blue);
        border-radius: 50%;
        animation: spin 1s linear infinite;
        margin-right: 12px;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      /* Empty state */
      .empty-state {
        text-align: center;
        padding: 60px;
        color: var(--text-secondary);
      }

      .empty-state-icon {
        font-size: 48px;
        margin-bottom: 16px;
      }

      /* Responsive */
      @media (max-width: 900px) {
        .main {
          grid-template-columns: 1fr;
        }
        .sidebar {
          display: none;
        }
        .detail-grid {
          grid-template-columns: repeat(2, 1fr);
        }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <h1>
        <span>ðŸ“Š</span>
        Crypto Market Analyzer
      </h1>
      <div class="status-bar">
        <div class="status-item">
          <div class="status-dot" id="status-dot"></div>
          <span id="status-text">Scanning...</span>
        </div>
        <div class="status-item">
          <span>Last scan:</span>
          <span id="last-scan">--:--</span>
        </div>
        <div class="status-item">
          <span>Scans:</span>
          <span id="scan-count">0</span>
        </div>
        <button class="btn" onclick="triggerScan()">Scan Now</button>
      </div>
    </header>

    <main class="main">
      <aside class="sidebar">
        <div class="section-title">Overview</div>

        <div class="stat-card">
          <div class="stat-label">Coins Tracked</div>
          <div class="stat-value" id="coins-count">--</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">High Score (A/B)</div>
          <div class="stat-value positive" id="high-score-count">--</div>
        </div>

        <div class="stat-card">
          <div class="stat-label">Avg Score</div>
          <div class="stat-value" id="avg-score">--</div>
        </div>

        <div class="section-title" style="margin-top: 24px">Score Legend</div>
        <div class="legend">
          <div class="legend-item">
            <span class="grade-badge grade-a">A+/A</span>
            <span>90-100 / 80-89</span>
          </div>
          <div class="legend-item">
            <span class="grade-badge grade-b">B</span>
            <span>70-79</span>
          </div>
          <div class="legend-item">
            <span class="grade-badge grade-c">C</span>
            <span>60-69</span>
          </div>
          <div class="legend-item">
            <span class="grade-badge grade-d">D/F</span>
            <span>Below 60</span>
          </div>
        </div>

        <div class="section-title" style="margin-top: 24px">
          Scoring Criteria
        </div>
        <div
          style="
            font-size: 12px;
            color: var(--text-secondary);
            line-height: 1.6;
          "
        >
          <p>
            <strong>Volume (25pts)</strong><br />Current vs 20-period average
          </p>
          <p style="margin-top: 8px">
            <strong>OBV (25pts)</strong><br />Trend direction & strength
          </p>
          <p style="margin-top: 8px">
            <strong>Funding (25pts)</strong><br />Rate within healthy range
          </p>
          <p style="margin-top: 8px">
            <strong>RSI (25pts)</strong><br />Not overbought/oversold
          </p>
        </div>
      </aside>

      <section class="content">
        <div class="content-header">
          <h2>Market Analysis</h2>
          <div class="filter-tabs">
            <button class="filter-tab active" onclick="filterCoins('all')">
              All
            </button>
            <button class="filter-tab" onclick="filterCoins('high')">
              High Score
            </button>
            <button class="filter-tab" onclick="filterCoins('volume')">
              High Volume
            </button>
            <button class="filter-tab" onclick="filterCoins('bullish')">
              Bullish OBV
            </button>
          </div>
        </div>

        <div id="table-container">
          <div class="loading">
            <div class="spinner"></div>
            <span>Loading market data...</span>
          </div>
        </div>
      </section>
    </main>

    <!-- Detail Modal -->
    <div class="modal" id="detail-modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2 id="modal-title">Coin Details</h2>
          <button class="modal-close" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body" id="modal-body">
          <!-- Content loaded dynamically -->
        </div>
      </div>
    </div>

    <script>
      let allCoins = [];
      let ws;

      // Initialize
      document.addEventListener("DOMContentLoaded", () => {
        initWebSocket();
        fetchData();
        setInterval(fetchData, 30000);
      });

      function initWebSocket() {
        const protocol = location.protocol === "https:" ? "wss:" : "ws:";
        ws = new WebSocket(`${protocol}//${location.host}/ws`);

        ws.onopen = () => {
          document.getElementById("status-text").textContent = "Connected";
        };

        ws.onmessage = (event) => {
          const data = JSON.parse(event.data);
          if (data.type === "scan_complete") {
            fetchData();
          }
        };

        ws.onclose = () => {
          document.getElementById("status-text").textContent =
            "Reconnecting...";
          setTimeout(initWebSocket, 3000);
        };
      }

      async function fetchData() {
        try {
          const response = await fetch("/api/scan");
          const data = await response.json();

          allCoins = data.results || [];

          document.getElementById("scan-count").textContent = data.scan_count;
          document.getElementById("last-scan").textContent = data.last_scan
            ? new Date(data.last_scan).toLocaleTimeString()
            : "--:--";
          document.getElementById("coins-count").textContent = allCoins.length;

          const highScore = allCoins.filter(
            (c) => c.score.percentage >= 70
          ).length;
          document.getElementById("high-score-count").textContent = highScore;

          const avgScore =
            allCoins.length > 0
              ? Math.round(
                  allCoins.reduce((sum, c) => sum + c.score.percentage, 0) /
                    allCoins.length
                )
              : 0;
          document.getElementById("avg-score").textContent = avgScore + "%";

          renderTable(allCoins);
        } catch (error) {
          console.error("Error fetching data:", error);
        }
      }

      async function triggerScan() {
        try {
          document.getElementById("status-text").textContent = "Scanning...";
          await fetch("/api/scan/trigger", { method: "POST" });
        } catch (error) {
          console.error("Error triggering scan:", error);
        }
      }

      function filterCoins(filter) {
        document
          .querySelectorAll(".filter-tab")
          .forEach((tab) => tab.classList.remove("active"));
        event.target.classList.add("active");

        let filtered = [...allCoins];

        switch (filter) {
          case "high":
            filtered = allCoins.filter((c) => c.score.percentage >= 70);
            break;
          case "volume":
            filtered = allCoins.filter(
              (c) => c.indicators["1h"].volume_ratio >= 1.5
            );
            break;
          case "bullish":
            filtered = allCoins.filter(
              (c) => c.indicators["1h"].obv_trend === "bullish"
            );
            break;
        }

        renderTable(filtered);
      }

      function renderTable(coins) {
        const container = document.getElementById("table-container");

        if (coins.length === 0) {
          container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ðŸ“­</div>
                        <p>No coins match the criteria</p>
                    </div>
                `;
          return;
        }

        const html = `
                <table class="coins-table">
                    <thead>
                        <tr>
                            <th>Coin</th>
                            <th>Price</th>
                            <th>24h Change</th>
                            <th>Volume</th>
                            <th>OBV</th>
                            <th>RSI</th>
                            <th>Funding</th>
                            <th>Score</th>
                            <th>Signals</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${coins.map((coin) => renderRow(coin)).join("")}
                    </tbody>
                </table>
            `;

        container.innerHTML = html;
      }

      function renderRow(coin) {
        const ind = coin.indicators["1h"];
        const scoreClass = getScoreClass(coin.score.grade);
        const priceClass = coin.price_change_24h >= 0 ? "positive" : "negative";
        const volumeClass = getVolumeClass(ind.volume_ratio);
        const obvClass =
          ind.obv_trend === "bullish"
            ? "positive"
            : ind.obv_trend === "bearish"
            ? "negative"
            : "neutral";
        const rsiClass =
          ind.rsi < 30 ? "positive" : ind.rsi > 70 ? "negative" : "neutral";
        const fundingClass =
          Math.abs(coin.funding_rate) < 0.01
            ? "neutral"
            : coin.funding_rate > 0
            ? "negative"
            : "positive";

        return `
                <tr onclick="showDetail('${coin.symbol}')">
                    <td>
                        <div class="coin-name">
                            <div class="coin-icon">${coin.display_name.slice(
                              0,
                              2
                            )}</div>
                            <div>
                                <div class="coin-symbol">${
                                  coin.display_name
                                }</div>
                                <div class="coin-pair">USDT</div>
                            </div>
                        </div>
                    </td>
                    <td>$${formatPrice(coin.price)}</td>
                    <td class="${priceClass}">${
          coin.price_change_24h > 0 ? "+" : ""
        }${coin.price_change_24h}%</td>
                    <td>
                        <div class="${volumeClass}">${ind.volume_ratio.toFixed(
          2
        )}x</div>
                        <div class="indicator-bar">
                            <div class="indicator-fill ${volumeClass}" style="width: ${Math.min(
          ind.volume_ratio * 33,
          100
        )}%"></div>
                        </div>
                    </td>
                    <td class="${obvClass}">
                        ${
                          ind.obv_trend === "bullish"
                            ? "â†‘"
                            : ind.obv_trend === "bearish"
                            ? "â†“"
                            : "â†’"
                        }
                        ${
                          ind.obv_change > 0 ? "+" : ""
                        }${ind.obv_change.toFixed(1)}%
                    </td>
                    <td class="${rsiClass}">${ind.rsi.toFixed(0)}</td>
                    <td class="${fundingClass}">${coin.funding_rate.toFixed(
          4
        )}%</td>
                    <td>
                        <div class="score-circle ${scoreClass}">${
          coin.score.grade
        }</div>
                    </td>
                    <td>
                        <div class="signal-tags">
                            ${coin.signals
                              .slice(0, 2)
                              .map(
                                (s) => `<span class="signal-tag">${s}</span>`
                              )
                              .join("")}
                        </div>
                    </td>
                </tr>
            `;
      }

      function getScoreClass(grade) {
        if (grade.startsWith("A")) return "score-a";
        if (grade === "B") return "score-b";
        if (grade === "C") return "score-c";
        return "score-d";
      }

      function getVolumeClass(ratio) {
        if (ratio >= 1.5) return "high";
        if (ratio >= 0.8) return "medium";
        return "low";
      }

      function formatPrice(price) {
        if (price >= 1000) return price.toFixed(2);
        if (price >= 1) return price.toFixed(4);
        return price.toFixed(6);
      }

      async function showDetail(symbol) {
        const modal = document.getElementById("detail-modal");
        const title = document.getElementById("modal-title");
        const body = document.getElementById("modal-body");

        title.textContent = symbol.replace("USDT", "") + " Analysis";
        body.innerHTML =
          '<div class="loading"><div class="spinner"></div>Loading...</div>';
        modal.classList.add("active");

        try {
          const response = await fetch(`/api/coin/${symbol}`);
          const coin = await response.json();

          const ind = coin.indicators["1h"];
          const ind4h = coin.indicators["4h"] || {};

          body.innerHTML = `
                    <div class="detail-grid">
                        <div class="detail-card">
                            <div class="detail-label">Price</div>
                            <div class="detail-value">$${formatPrice(
                              coin.price
                            )}</div>
                            <div class="stat-change ${
                              coin.price_change_24h >= 0
                                ? "positive"
                                : "negative"
                            }">
                                ${coin.price_change_24h > 0 ? "+" : ""}${
            coin.price_change_24h
          }% (24h)
                            </div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-label">Score</div>
                            <div class="detail-value">${
                              coin.score.percentage
                            }%</div>
                            <div class="stat-change">Grade: ${
                              coin.score.grade
                            }</div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-label">Trend</div>
                            <div class="detail-value">${ind.trend.toUpperCase()}</div>
                            <div class="stat-change">4H: ${
                              ind4h.trend || "N/A"
                            }</div>
                        </div>
                    </div>

                    <div class="section-title">Indicators</div>
                    <div class="detail-grid">
                        <div class="detail-card">
                            <div class="detail-label">Volume Ratio</div>
                            <div class="detail-value">${ind.volume_ratio.toFixed(
                              2
                            )}x</div>
                            <div class="stat-change">vs 20-period avg</div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-label">OBV Trend</div>
                            <div class="detail-value ${
                              ind.obv_trend === "bullish"
                                ? "positive"
                                : ind.obv_trend === "bearish"
                                ? "negative"
                                : ""
                            }">${ind.obv_trend.toUpperCase()}</div>
                            <div class="stat-change">${
                              ind.obv_change > 0 ? "+" : ""
                            }${ind.obv_change.toFixed(2)}%</div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-label">RSI (14)</div>
                            <div class="detail-value">${ind.rsi.toFixed(
                              1
                            )}</div>
                            <div class="stat-change">${
                              ind.rsi < 30
                                ? "Oversold"
                                : ind.rsi > 70
                                ? "Overbought"
                                : "Neutral"
                            }</div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-label">Funding Rate</div>
                            <div class="detail-value">${coin.funding_rate.toFixed(
                              4
                            )}%</div>
                            <div class="stat-change">Daily: ${coin.funding_rate_daily.toFixed(
                              4
                            )}%</div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-label">Volatility (ATR%)</div>
                            <div class="detail-value">${ind.atr_percent.toFixed(
                              2
                            )}%</div>
                        </div>
                        <div class="detail-card">
                            <div class="detail-label">MACD</div>
                            <div class="detail-value ${
                              ind.macd_bullish ? "positive" : "negative"
                            }">${ind.macd_bullish ? "Bullish" : "Bearish"}</div>
                        </div>
                    </div>

                    <div class="section-title">Moving Averages</div>
                    <ul class="breakdown-list">
                        <li class="breakdown-item">
                            <span>SMA 20</span>
                            <span>$${formatPrice(ind.sma_20)}</span>
                        </li>
                        <li class="breakdown-item">
                            <span>SMA 50</span>
                            <span>$${formatPrice(ind.sma_50)}</span>
                        </li>
                        <li class="breakdown-item">
                            <span>SMA 200</span>
                            <span>$${formatPrice(ind.sma_200)}</span>
                        </li>
                    </ul>

                    <div class="section-title">Score Breakdown</div>
                    <ul class="breakdown-list">
                        ${coin.score.breakdown
                          .map(
                            ([category, status, points]) => `
                            <li class="breakdown-item">
                                <span>${category.toUpperCase()} - ${status}</span>
                                <span>${points}/25</span>
                            </li>
                        `
                          )
                          .join("")}
                    </ul>

                    <div class="section-title">Signals</div>
                    <div class="signal-tags" style="flex-wrap: wrap; gap: 8px;">
                        ${coin.signals
                          .map(
                            (s) =>
                              `<span class="signal-tag" style="padding: 6px 10px;">${s}</span>`
                          )
                          .join("")}
                    </div>
                `;
        } catch (error) {
          body.innerHTML = `<div class="empty-state">Error loading data</div>`;
        }
      }

      function closeModal() {
        document.getElementById("detail-modal").classList.remove("active");
      }

      // Close modal on escape key
      document.addEventListener("keydown", (e) => {
        if (e.key === "Escape") closeModal();
      });

      // Close modal on outside click
      document.getElementById("detail-modal").addEventListener("click", (e) => {
        if (e.target.classList.contains("modal")) closeModal();
      });
    </script>
  </body>
</html>
